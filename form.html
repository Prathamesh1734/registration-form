<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form</title>

    <style>
        .head {
            padding: 0px 500px;
        }

        .formdesign {
            font-size: medium;
            margin: 20px;
        }

        .formdesign2 {
            font-size: medium;
            margin: 20px;
        }

        .formdesign3 {
            font-size: medium;
            margin: 20px;
        }

        .formerror {
            color: red;
        }

        .button {
            font-size: medium;
            margin: 0px 500px;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;           
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="head">
        <h1>Registration Form</h1>
    </div>
    <form action="http://pixel6.co/" name="myForm" id="form-id" method="POST">
        <div class="formdesign" id="name">
            Name: <input type="text" name="fname" required>
            <b><span class="formerror"></span></b>
        </div>

        <div class="formdesign2" id="email">
            Email: <input type="email" name="femail" required>
            <b><span class="formerror"></span></b>
        </div>

        <div class="formdesign3" id="phone">
            Phone Number: <input type="phone" id="iphone" name="fphone" required onkeyup="formatPhoneNumber(event)"
                maxlength="14"><label id="logo"></label> <label id="state"></label>
            <b><span class="formerror"></span></b>
        </div>

        <input class="button" type="button" onClick="validateForm();generateOTP()" id="mysubmit" value="submit" />

    </form>
    <div id="myModal" class="modal">

        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Dear <label id="firstName" ></label>,</p>
                <p>Thank you for your inquiry. A 4 digit verification number has been sent to your phone number: <label id="phoneNumber"></label>,</p> 
                    <p>Please enter in the following box and submit for confirmation:</p>
                    OTP:<input type="text" data-OTP="" data-attempt=1 maxlength=4 id="otp"/>
                    <input class="button" type="button" id="otpsubmit" value="Validate" onclick="submitForm()"/>
        </div>
    </div>
</body>

<script>
    function submitForm(){
        var otpinput = document.getElementById("otp");
        var otp = otpinput.getAttribute("data-OTP");
        
        if(otp==otpinput.value){
            var form = document.getElementById("form-id");
            form.submit();
        }
        else{
            debugger;
            var attempt=parseInt(otpinput.getAttribute("data-attempt"));
            if(attempt>3){
                window.location.href = "http://pixel6.co/404";
            }
            otpinput.setAttribute("data-attempt",attempt+1);
        }  
    }

    function clearErrors() {

        errors = document.getElementsByClassName('formerror');
        for (let item of errors) {
            item.innerHTML = "";
        }
    }

    function seterror(id, error) {
        element = document.getElementById(id);
        element.getElementsByClassName('formerror')[0].innerHTML = error;
    }

    function validateForm() {

        var returnval = true;
        clearErrors();

        var correct_way = /^[A-Za-z\s]+$/;

        var name = document.forms['myForm']["fname"].value;
        if (name.length == 0) {
            seterror("name", " Name cannot be blank");
            returnval = false;
        }

        if (name.match(correct_way)) {
            true;
        }
        else {
            seterror("name", " Only alphabets are allowed");
            returnval = false;
        }

        var phone = document.forms['myForm']["fphone"].value;

        if (phone.length != 14) {
            seterror("phone", " Number must be 10 digit");
            returnval = false;
        }
        
        var name1=document.forms['myForm']["fname"].value;
        const myArr=name1.split(" ");
        var name2=(document.getElementById("firstName").innerHTML = myArr[0]);
        var name3=(document.getElementById("firstName").innerHTML = myArr[1]);

        if(name2.length<=4){
            seterror("name", "Minimum 4 characters are required");
            returnval = false;
        }
        else if(name3.length<=4){
            seterror("name", "Minimum 4 characters are required");
            returnval = false;
        }

        if (returnval) {
            
            document.getElementById("firstName").innerHTML = name2;
            
            document.getElementById("phoneNumber").innerHTML = phone;
            
            var modal = document.getElementById("myModal");

            var btn = document.getElementById("mysubmit");

            var span = document.getElementsByClassName("close")[0];

            btn.onclick = function () {
                modal.style.display = "block";
            }

            span.onclick = function () {
                modal.style.display = "none";
            }

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        return returnval;
    }

    function formatPhoneNumber(e) {
        if (e.keyCode == 8) {

        }
        else {
            if (e.target.value.length == 3 && e.target.value.substring(0, 1) != "(") {
                document.getElementById("iphone").value = "(" + e.target.value + ")" + "-";
            }
            else if (e.target.value.length == 9) {
                document.getElementById("iphone").value = e.target.value + "-";
            }
            else if (e.target.value.length == 4 && e.target.value.substring(4, 6) != ")" + "-") {
                document.getElementById("iphone").value = e.target.value.substring(0, 4) + ")" + "-" + e.target.value.substring(4, 6);
            }
            else if (e.target.value.length == 10 && e.target.value.substring(9, 10) != "-") {
                document.getElementById("iphone").value = e.target.value.substring(0, 9) + "-" + e.target.value.substring(9, 10);
            }
        }
        if (e.target.value.length == 14) {
            var code1 = e.target.value.substring(1, 4);
            if (code1 >= 621 && code1 <= 799) {
                document.getElementById("logo").innerHTML = "Reliance Jio,";
            }
            else if (code1 >= 801 && code1 <= 920) {
                document.getElementById("logo").innerHTML = "IDEA,";
            }
            else if (code1 >= 921 && code1 <= 999) {
                document.getElementById("logo").innerHTML = "Vodafone,";
            }
            else {
                document.getElementById("logo").innerHTML = "INVALID NUMBER"
            }
            var code2 = e.target.value.substring(6, 9);
            setStates(code2);
        }
    }
    function generateOTP() {
        var digits = '0123456789';
        let OTP = '';
        for (let i = 0; i < 4; i++) {
            OTP += digits[Math.floor(Math.random() * 10)];
        }
        console.log(OTP);
        var otpValue = document.getElementById("otp");
        otpValue.setAttribute("data-OTP", OTP);
    }
    
    function setStates(e) {
        var states = { 100: "Andhra Pradesh", 101: "Arunachal Pradesh", 102: "Assam", 103: "Bihar", 104: "Chattisgarh", 105: "Goa", 106: "Gujrat", 107: "Haryana", 108: "Himachal Pradesh", 109: "Jharkhand", 110: "Karnataka", 111: "Kerala", 112: "Madhya Pradesh", 113: "Manipur", 114: "Meghalaya", 115: "Mizoram", 116: "Nagaland", 117: "Odisha", 118: "Punjab", 119: "Maharashtra", 120: "Rajasthan", 121: "Sikkim", 122: "Tamil Nadu", 123: "Telangana", 124: "Tripura", 125: "Uttar Pradesh", 126: "Uttarakhand", 127: "West Bengal", 128: "Andaman and Nicobar Islands", 129: "Chandigarh", 130: "Daman Diu", 131: "Delhi", 132: "Jammu and Kashmir", 133: "Ladakh", 134: "Lakshadweep", 135: "Puducherry"};
        if (e > 135 && e < 100) {
            document.getElementById("state").innerHTML = "INVALID NUMBER";
        }
        else {
            document.getElementById("state").innerHTML = states[e];
        }
    }
</script>

</html>